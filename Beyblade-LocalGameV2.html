<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Beyblade Ultimate Showdown - Complete</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .game-container {
            width: 100%;
            max-width: 1400px;
            background: rgba(0, 0, 0, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            border: 3px solid #667eea;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            color: #ffff00;
            font-size: 3em;
            text-shadow: 0 0 20px rgba(255, 255, 0, 0.5);
            margin-bottom: 10px;
            animation: titleGlow 2s infinite;
        }

        @keyframes titleGlow {
            0%, 100% { text-shadow: 0 0 20px rgba(255, 255, 0, 0.5); }
            50% { text-shadow: 0 0 40px rgba(255, 255, 0, 0.8); }
        }

        .screen {
            display: none;
            animation: fadeIn 0.5s ease-in;
        }

        .screen.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }

        .menu-button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: 2px solid #ffff00;
            padding: 20px 40px;
            font-size: 1.2em;
            border-radius: 10px;
            cursor: pointer;
            margin: 15px;
            transition: all 0.3s;
            font-weight: bold;
            text-transform: uppercase;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .menu-button:hover {
            transform: scale(1.05);
            box-shadow: 0 10px 25px rgba(255, 255, 0, 0.5);
        }

        .menu-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* ===== STADIUM ===== */
        .stadium {
            width: 100%;
            height: 400px;
            background: radial-gradient(circle at center, rgba(255,255,0,0.2) 0%, rgba(102,126,234,0.3) 40%, rgba(0,0,0,0.8) 100%);
            border: 4px solid #667eea;
            border-radius: 50%;
            margin: 20px auto;
            display: flex;
            justify-content: space-around;
            align-items: center;
            position: relative;
            overflow: hidden;
            box-shadow: inset 0 0 30px rgba(102, 126, 234, 0.5);
        }

        .stadium::before {
            content: '';
            position: absolute;
            width: 300px;
            height: 300px;
            border: 3px dashed #667eea;
            border-radius: 50%;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            opacity: 0.5;
        }

        .stadium::after {
            content: '';
            position: absolute;
            width: 200px;
            height: 200px;
            border: 2px solid #ffff00;
            border-radius: 50%;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            opacity: 0.3;
        }

        .bey-slot {
            position: relative;
            z-index: 2;
            text-align: center;
            flex: 1;
        }

        .bey-display {
            font-size: 8em;
            animation: spin 3s linear infinite;
            filter: drop-shadow(0 0 15px rgba(255, 255, 0, 0.6));
            transition: transform 0.3s;
        }

        .bey-display.hit {
            animation: hitShake 0.3s, spin 3s linear infinite;
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        @keyframes hitShake {
            0%, 100% { transform: translateX(0) rotate(0deg); }
            25% { transform: translateX(-20px) rotate(-5deg); }
            75% { transform: translateX(20px) rotate(5deg); }
        }

        .bey-info {
            color: white;
            margin-top: 15px;
        }

        .bey-name {
            font-size: 1.5em;
            font-weight: bold;
            color: #ffff00;
            margin-bottom: 10px;
        }

        .stat-bar {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin: 10px 0;
            font-size: 0.9em;
        }

        .bar {
            width: 120px;
            height: 20px;
            background: #333;
            border: 1px solid #667eea;
            border-radius: 5px;
            overflow: hidden;
            position: relative;
        }

        .bar-fill {
            height: 100%;
            background: linear-gradient(90deg, #00ff00, #ffff00);
            width: 100%;
            transition: width 0.5s ease;
        }

        .bar-fill.stamina {
            background: linear-gradient(90deg, #ff8800, #ffaa00);
        }

        .bar-fill.special {
            background: linear-gradient(90deg, #ff00ff, #ffff00);
        }

        .bar-fill.critical {
            background: linear-gradient(90deg, #ff0000, #ff6b6b);
            animation: critPulse 0.5s infinite;
        }

        @keyframes critPulse {
            0%, 100% { filter: brightness(1); }
            50% { filter: brightness(1.3); }
        }

        .bar-label {
            position: absolute;
            top: 2px;
            left: 5px;
            font-size: 0.7em;
            color: #fff;
            font-weight: bold;
        }

        /* ===== STATUS DISPLAY ===== */
        .status-display {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }

        .player-status {
            background: rgba(102, 126, 234, 0.2);
            border: 2px solid #667eea;
            padding: 15px;
            border-radius: 10px;
            color: white;
        }

        .player-status h3 {
            color: #ffff00;
            margin-bottom: 10px;
        }

        .status-item {
            display: flex;
            justify-content: space-between;
            margin: 8px 0;
            font-size: 0.9em;
        }

        .status-label {
            color: #aaa;
        }

        .status-value {
            color: #ffff00;
            font-weight: bold;
        }

        /* ===== BATTLE LOG ===== */
        .battle-log {
            background: rgba(0, 0, 0, 0.8);
            border: 2px solid #667eea;
            border-radius: 10px;
            padding: 15px;
            height: 180px;
            overflow-y: auto;
            color: #0f0;
            font-family: 'Courier New', monospace;
            font-size: 0.85em;
            margin: 20px 0;
            box-shadow: inset 0 0 10px rgba(102, 126, 234, 0.3);
        }

        .log-entry {
            margin: 5px 0;
            padding: 3px 0;
            border-bottom: 1px solid rgba(0, 255, 0, 0.2);
        }

        .log-entry.damage {
            color: #ff6b6b;
        }

        .log-entry.heal {
            color: #00ff00;
        }

        .log-entry.special {
            color: #ffff00;
        }

        /* ===== CONTROLS ===== */
        .battle-controls {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin: 20px 0;
        }

        .control-group {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }

        .action-button {
            background: linear-gradient(135deg, #00ff00 0%, #00cc00 100%);
            color: #000;
            border: 2px solid #ffff00;
            padding: 15px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            font-size: 0.95em;
            transition: all 0.3s;
            box-shadow: 0 5px 15px rgba(0, 255, 0, 0.4);
        }

        .action-button:hover:not(:disabled) {
            transform: scale(1.05);
            box-shadow: 0 0 25px rgba(0, 255, 0, 0.8);
        }

        .action-button:disabled {
            opacity: 0.4;
            cursor: not-allowed;
            box-shadow: none;
        }

        .action-button.special {
            background: linear-gradient(135deg, #ff00ff 0%, #ff6b00 100%);
            font-size: 1.1em;
            grid-column: 1 / -1;
        }

        .action-button.special:not(:disabled) {
            box-shadow: 0 0 20px rgba(255, 0, 255, 0.6);
            animation: specialPulse 0.5s infinite;
        }

        @keyframes specialPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.02); }
        }

        .action-button.burst {
            background: linear-gradient(135deg, #ffaa00 0%, #ff0000 100%);
        }

        .action-button.burst:not(:disabled) {
            box-shadow: 0 0 20px rgba(255, 100, 0, 0.6);
        }

        .cooldown-text {
            font-size: 0.8em;
            opacity: 0.8;
        }

        /* ===== MENUS ===== */
        .menu-screen {
            text-align: center;
        }

        .bey-showcase {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .bey-card {
            background: rgba(102, 126, 234, 0.2);
            border: 2px solid #667eea;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            color: white;
        }

        .bey-card:hover {
            transform: scale(1.05);
            border-color: #ffff00;
        }

        .bey-card.selected {
            border-color: #00ff00;
            box-shadow: 0 0 20px rgba(0, 255, 0, 0.5);
        }

        .bey-icon {
            font-size: 3em;
            margin: 10px 0;
        }

        .bey-name-text {
            font-weight: bold;
            color: #ffff00;
            margin: 10px 0;
        }

        .bey-stats-small {
            font-size: 0.75em;
            color: #ddd;
        }

        .stat-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 5px;
            margin-top: 10px;
            font-size: 0.75em;
        }

        .stat-mini {
            background: rgba(0, 0, 0, 0.5);
            padding: 5px;
            border-radius: 3px;
            color: #ffff00;
        }

        /* ===== STORY MODE ===== */
        .story-screen {
            text-align: center;
        }

        .story-info {
            background: rgba(102, 126, 234, 0.2);
            border: 2px solid #667eea;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            color: white;
        }

        .story-info h3 {
            color: #ffff00;
            margin-bottom: 10px;
        }

        .battle-number {
            font-size: 2em;
            color: #ffff00;
            margin: 20px 0;
            font-weight: bold;
        }

        .opponent-info {
            background: rgba(0, 100, 0, 0.2);
            border: 2px solid #00ff00;
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            color: #00ff00;
        }

        /* ===== END SCREEN ===== */
        .end-screen {
            text-align: center;
        }

        .winner-text {
            color: #ffff00;
            font-size: 3em;
            font-weight: bold;
            text-shadow: 0 0 20px rgba(255, 255, 0, 0.5);
            margin: 30px 0;
        }

        .result-message {
            background: rgba(0, 255, 0, 0.2);
            border: 2px solid #00ff00;
            color: #00ff00;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            font-size: 1.1em;
            font-weight: bold;
        }

        .input-field {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid #667eea;
            padding: 12px;
            border-radius: 8px;
            color: white;
            font-size: 1em;
            margin: 10px;
            width: 300px;
        }

        .input-field::placeholder {
            color: #aaa;
        }

        .mode-selector {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .mode-card {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.3), rgba(118, 75, 162, 0.3));
            border: 3px solid #667eea;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            color: white;
        }

        .mode-card:hover {
            transform: scale(1.05);
            border-color: #ffff00;
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.5);
        }

        .mode-icon {
            font-size: 3em;
            margin: 15px 0;
        }

        .mode-title {
            font-size: 1.5em;
            font-weight: bold;
            color: #ffff00;
            margin: 10px 0;
        }

        .mode-description {
            color: #ddd;
            font-size: 0.9em;
        }

        .countdown {
            font-size: 3em;
            font-weight: bold;
            color: #ffff00;
            margin: 20px 0;
            animation: countdownBounce 1s;
        }

        @keyframes countdownBounce {
            0% { transform: scale(1.5); opacity: 0; }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); opacity: 1; }
        }

        .message-box {
            background: rgba(255, 165, 0, 0.2);
            border: 2px solid #ffaa00;
            color: #ffaa00;
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            font-weight: bold;
        }

        .move-name {
            color: #ffff00;
            font-weight: bold;
            font-size: 1.1em;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="header">
            <h1>‚≠ê BEYBLADE ULTIMATE SHOWDOWN ‚≠ê</h1>
            <p style="color: #667eea; font-size: 1.2em;">LET IT RIP! üî•</p>
        </div>

        <!-- MAIN MENU -->
        <div class="screen active menu-screen" id="menuScreen">
            <h2 style="color: #667eea; margin: 30px 0; font-size: 2.5em;">WELCOME TO THE ARENA</h2>
            
            <div class="bey-showcase">
                <div class="bey-card">
                    <div class="bey-icon">üå™Ô∏è</div>
                    <div class="bey-name-text">Spryzen</div>
                    <div class="stat-grid">
                        <div class="stat-mini">ATK: 8</div>
                        <div class="stat-mini">DEF: 6</div>
                        <div class="stat-mini">SPD: 9</div>
                        <div class="stat-mini">STA: 7</div>
                    </div>
                </div>
                <div class="bey-card">
                    <div class="bey-icon">‚ö°</div>
                    <div class="bey-name-text">Valtrak</div>
                    <div class="stat-grid">
                        <div class="stat-mini">ATK: 9</div>
                        <div class="stat-mini">DEF: 5</div>
                        <div class="stat-mini">SPD: 8</div>
                        <div class="stat-mini">STA: 6</div>
                    </div>
                </div>
                <div class="bey-card">
                    <div class="bey-icon">üêâ</div>
                    <div class="bey-name-text">Fafnir</div>
                    <div class="stat-grid">
                        <div class="stat-mini">ATK: 9</div>
                        <div class="stat-mini">DEF: 8</div>
                        <div class="stat-mini">SPD: 6</div>
                        <div class="stat-mini">STA: 8</div>
                    </div>
                </div>
                <div class="bey-card">
                    <div class="bey-icon">üî•</div>
                    <div class="bey-name-text">Phoenix</div>
                    <div class="stat-grid">
                        <div class="stat-mini">ATK: 8</div>
                        <div class="stat-mini">DEF: 7</div>
                        <div class="stat-mini">SPD: 8</div>
                        <div class="stat-mini">STA: 8</div>
                    </div>
                </div>
                <div class="bey-card">
                    <div class="bey-icon">üíÄ</div>
                    <div class="bey-name-text">Prime Apocalypse</div>
                    <div class="stat-grid">
                        <div class="stat-mini">ATK: 10</div>
                        <div class="stat-mini">DEF: 6</div>
                        <div class="stat-mini">SPD: 7</div>
                        <div class="stat-mini">STA: 7</div>
                    </div>
                </div>
            </div>

            <div class="mode-selector">
                <div class="mode-card" onclick="game.startStoryMode()">
                    <div class="mode-icon">üìñ</div>
                    <div class="mode-title">STORY MODE</div>
                    <div class="mode-description">Battle through 5 opponents and face the final boss!</div>
                </div>
                <div class="mode-card" onclick="game.startPvpMode()">
                    <div class="mode-icon">‚öîÔ∏è</div>
                    <div class="mode-title">PVP MODE</div>
                    <div class="mode-description">Battle your friend on the same device!</div>
                </div>
            </div>
        </div>

        <!-- STORY MODE SELECTION -->
        <div class="screen story-screen" id="storySelectScreen">
            <h2 style="color: #667eea; margin: 30px 0; font-size: 2.5em;">STORY MODE - CHOOSE YOUR BEYBLADES</h2>
            
            <div style="margin: 20px 0;">
                <p style="color: #fff; margin: 20px 0; font-size: 1.1em;">SELECT YOUR BEYBLADES</p>
                <div class="bey-showcase" id="storyBeySelection">
                    <!-- Filled dynamically -->
                </div>
                <button class="menu-button" id="startStoryBtn" onclick="game.beginStory()" disabled style="margin-top: 30px;">START STORY</button>
                <button class="menu-button" onclick="game.showMenu()" style="background: #666;">BACK</button>
            </div>
        </div>

        <!-- PVP NAMES & SELECTION -->
        <div class="screen" id="pvpSetupScreen">
            <h2 style="color: #667eea; margin: 30px 0; font-size: 2.5em;">PVP MODE - SETUP</h2>
            
            <div style="text-align: center; margin: 20px 0;">
                <p style="color: #fff; margin: 20px 0;">Player 1 Name:</p>
                <input type="text" class="input-field" id="pvpPlayer1Name" placeholder="Enter name" maxlength="15">
                
                <p style="color: #fff; margin: 20px 0;">Player 2 Name:</p>
                <input type="text" class="input-field" id="pvpPlayer2Name" placeholder="Enter name" maxlength="15">
                
                <button class="menu-button" onclick="game.proceedToPvpSelection()" style="margin-top: 30px;">CONTINUE</button>
                <button class="menu-button" onclick="game.showMenu()" style="background: #666;">BACK</button>
            </div>
        </div>

        <!-- PVP BEY SELECTION -->
        <div class="screen" id="pvpBeyScreen">
            <h2 style="color: #667eea; margin: 30px 0; font-size: 2.5em;">PVP MODE - SELECT BEYBLADES</h2>
            
            <div style="text-align: center;">
                <p style="color: #ff6b6b; font-weight: bold; margin: 20px 0; font-size: 1.2em;">PLAYER 1 - SELECT YOUR BEYBLADES</p>
                <div class="bey-showcase" id="pvpPlayer1Beys">
                    <!-- Filled dynamically -->
                </div>
                
                <p style="color: #667eea; font-weight: bold; margin: 30px 0 20px 0; font-size: 1.2em;">PLAYER 2 - SELECT YOUR BEYBLADES</p>
                <div class="bey-showcase" id="pvpPlayer2Beys">
                    <!-- Filled dynamically -->
                </div>
                
                <button class="menu-button" id="startPvpBtn" onclick="game.startPvpBattle()" disabled style="margin-top: 30px;">START BATTLE</button>
                <button class="menu-button" onclick="game.showMenu()" style="background: #666;">BACK</button>
            </div>
        </div>

        <!-- BATTLE SCREEN -->
        <div class="screen" id="battleScreen">
            <div style="text-align: center; margin: 20px 0;">
                <div id="countdownBox" style="display: none;">
                    <p style="color: #fff; font-size: 1.2em;">Battle starts in...</p>
                    <div class="countdown" id="countdown">3</div>
                </div>
                <div id="storyBattleInfo" style="display: none;">
                    <div class="battle-number" id="battleNumberDisplay"></div>
                    <div class="opponent-info" id="opponentInfoDisplay"></div>
                </div>
            </div>

            <div class="stadium" id="battleStadium">
                <div class="bey-slot">
                    <div class="bey-display" id="player1BeyDisplay"></div>
                    <div class="bey-info">
                        <div class="bey-name" id="player1Name"></div>
                        <div class="stat-bar">
                            <div class="bar">
                                <div class="bar-fill" id="player1Hp" style="width: 100%;"></div>
                                <div class="bar-label">HP</div>
                            </div>
                            <div class="bar">
                                <div class="bar-fill stamina" id="player1Stamina" style="width: 100%;"></div>
                                <div class="bar-label">STA</div>
                            </div>
                            <div class="bar">
                                <div class="bar-fill special" id="player1Special" style="width: 0%;"></div>
                                <div class="bar-label">SP</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="bey-slot">
                    <div class="bey-display" id="player2BeyDisplay"></div>
                    <div class="bey-info">
                        <div class="bey-name" id="player2Name"></div>
                        <div class="stat-bar">
                            <div class="bar">
                                <div class="bar-fill" id="player2Hp" style="width: 100%;"></div>
                                <div class="bar-label">HP</div>
                            </div>
                            <div class="bar">
                                <div class="bar-fill stamina" id="player2Stamina" style="width: 100%;"></div>
                                <div class="bar-label">STA</div>
                            </div>
                            <div class="bar">
                                <div class="bar-fill special" id="player2Special" style="width: 0%;"></div>
                                <div class="bar-label">SP</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="status-display">
                <div class="player-status">
                    <h3 id="p1StatusName"></h3>
                    <div class="status-item">
                        <span class="status-label">HP:</span>
                        <span class="status-value" id="p1HpStatus">100/100</span>
                    </div>
                    <div class="status-item">
                        <span class="status-label">Stamina:</span>
                        <span class="status-value" id="p1StaminaStatus">100/100</span>
                    </div>
                    <div class="status-item">
                        <span class="status-label">Special:</span>
                        <span class="status-value" id="p1SpecialStatus">0%</span>
                    </div>
                    <div class="status-item">
                        <span class="status-label">Bursts Blocked:</span>
                        <span class="status-value" id="p1Bursts">0</span>
                    </div>
                </div>

                <div class="player-status">
                    <h3 id="p2StatusName"></h3>
                    <div class="status-item">
                        <span class="status-label">HP:</span>
                        <span class="status-value" id="p2HpStatus">100/100</span>
                    </div>
                    <div class="status-item">
                        <span class="status-label">Stamina:</span>
                        <span class="status-value" id="p2StaminaStatus">100/100</span>
                    </div>
                    <div class="status-item">
                        <span class="status-label">Special:</span>
                        <span class="status-value" id="p2SpecialStatus">0%</span>
                    </div>
                    <div class="status-item">
                        <span class="status-label">Bursts Blocked:</span>
                        <span class="status-value" id="p2Bursts">0</span>
                    </div>
                </div>
            </div>

            <div class="battle-log" id="battleLog"></div>

            <div class="battle-controls">
                <div class="control-group">
                    <button class="action-button" id="p1Attack" onclick="game.playerAction(1, 'attack')">üî® ATTACK</button>
                    <button class="action-button" id="p1Defend" onclick="game.playerAction(1, 'defend')">üõ°Ô∏è DEFEND</button>
                    <button class="action-button special" id="p1Special" onclick="game.playerAction(1, 'special')">‚ö° SPECIAL ATTACK ‚ö°<br><small id="p1SpecialCD"></small></button>
                    <button class="action-button burst" id="p1Burst" onclick="game.playerAction(1, 'burst')">üí• BURST FINISH üí•<br><small id="p1BurstCD"></small></button>
                </div>
                <div style="width: 100%; text-align: center; grid-column: 1 / -1; color: #ffff00; font-size: 1.2em; font-weight: bold;">VS</div>
                <div class="control-group">
                    <button class="action-button" id="p2Attack" onclick="game.playerAction(2, 'attack')">üî® ATTACK</button>
                    <button class="action-button" id="p2Defend" onclick="game.playerAction(2, 'defend')">üõ°Ô∏è DEFEND</button>
                    <button class="action-button special" id="p2Special" onclick="game.playerAction(2, 'special')">‚ö° SPECIAL ATTACK ‚ö°<br><small id="p2SpecialCD"></small></button>
                    <button class="action-button burst" id="p2Burst" onclick="game.playerAction(2, 'burst')">üí• BURST FINISH üí•<br><small id="p2BurstCD"></small></button>
                </div>
            </div>
        </div>

        <!-- END SCREEN -->
        <div class="screen end-screen" id="endScreen">
            <div class="winner-text" id="winnerText">VICTORY!</div>
            <div class="result-message" id="resultMessage"></div>
            <div id="nextStoryBtn" style="display: none; margin: 20px 0;">
                <button class="menu-button" onclick="game.nextStoryBattle()">NEXT BATTLE ‚Üí</button>
            </div>
            <button class="menu-button" onclick="game.showMenu()" style="margin-top: 30px;">BACK TO MENU</button>
            <button class="menu-button" onclick="game.location.reload()" style="margin-top: 10px;">PLAY AGAIN</button>
        </div>
    </div>

    <script>
        // ===== BEYBLADES DATA =====
        const beyblades = {
            spryzen: {
                name: 'Spryzen',
                icon: 'üå™Ô∏è',
                type: 'Attack',
                attacks: [
                    { name: 'Wind Slash', damage: 12, staminaCost: 15 },
                    { name: 'Spiral Strike', damage: 18, staminaCost: 25 }
                ],
                specialAttack: { name: 'Ultimate Tornado', damage: 40, staminaCost: 60 },
                burst: { name: 'Spryzen Finish', damage: 50 },
                hp: 95,
                stamina: 100,
                defense: 6,
                speed: 9
            },
            valtrak: {
                name: 'Valtrak',
                icon: '‚ö°',
                type: 'Balance',
                attacks: [
                    { name: 'Lightning Jab', damage: 14, staminaCost: 20 },
                    { name: 'Volt Strike', damage: 20, staminaCost: 30 }
                ],
                specialAttack: { name: 'Megavolt Blast', damage: 45, staminaCost: 65 },
                burst: { name: 'Valtrak Clash', damage: 55 },
                hp: 90,
                stamina: 95,
                defense: 5,
                speed: 8
            },
            fafnir: {
                name: 'Fafnir',
                icon: 'üêâ',
                type: 'Stamina',
                attacks: [
                    { name: 'Dragon Claw', damage: 16, staminaCost: 18 },
                    { name: 'Ancient Fury', damage: 22, staminaCost: 28 }
                ],
                specialAttack: { name: 'Dragon\'s Wrath', damage: 48, staminaCost: 70 },
                burst: { name: 'Dragon Burst', damage: 58 },
                hp: 110,
                stamina: 120,
                defense: 8,
                speed: 6
            },
            phoenix: {
                name: 'Phoenix',
                icon: 'üî•',
                type: 'Balanced',
                attacks: [
                    { name: 'Flame Strike', damage: 15, staminaCost: 20 },
                    { name: 'Inferno Blaze', damage: 19, staminaCost: 28 }
                ],
                specialAttack: { name: 'Eternal Flame', damage: 42, staminaCost: 62 },
                burst: { name: 'Phoenix Rise', damage: 52 },
                hp: 100,
                stamina: 105,
                defense: 7,
                speed: 8
            },
            primeApocalypse: {
                name: 'Prime Apocalypse',
                icon: 'üíÄ',
                type: 'Attack',
                attacks: [
                    { name: 'Dark Impact', damage: 18, staminaCost: 22 },
                    { name: 'Void Crush', damage: 24, staminaCost: 32 }
                ],
                specialAttack: { name: 'Apocalyptic End', damage: 50, staminaCost: 75 },
                burst: { name: 'Apocalypse Finish', damage: 62 },
                hp: 105,
                stamina: 100,
                defense: 6,
                speed: 7
            }
        };

        // ===== STORY OPPONENTS =====
        const storyOpponents = [
            { name: 'Rookie Blader', bey: 'spryzen', difficulty: 0.7 },
            { name: 'Veteran Blader', bey: 'valtrak', difficulty: 0.8 },
            { name: 'Expert Trainer', bey: 'fafnir', difficulty: 0.85 },
            { name: 'Master of Blades', bey: 'phoenix', difficulty: 0.9 },
            { name: 'Supreme Champion', bey: 'primeApocalypse', difficulty: 1.0 },
            { name: 'FINAL BOSS - Ultimate Blader', bey: 'primeApocalypse', difficulty: 1.3 }
        ];

        // ===== GAME STATE =====
        const game = {
            gameMode: null, // 'story' or 'pvp'
            storyBattleIndex: 0,
            storyPlayerBey: null,
            storyPlayerName: 'Story Player',
            
            player1Name: '',
            player2Name: '',
            player1Bey: null,
            player2Bey: null,

            player1HP: 0,
            player2HP: 0,
            player1MaxHP: 0,
            player2MaxHP: 0,

            player1Stamina: 0,
            player2Stamina: 0,
            player1MaxStamina: 0,
            player2MaxStamina: 0,

            player1Special: 0,
            player2Special: 0,

            player1DefenseActive: false,
            player2DefenseActive: false,

            player1Bursts: 0,
            player2Bursts: 0,

            player1SpecialCD: 0,
            player2SpecialCD: 0,

            player1BurstCD: 0,
            player2BurstCD: 0,

            gameActive: false,

            showScreen(screenId) {
                document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
                document.getElementById(screenId).classList.add('active');
            },

            showMenu() {
                this.showScreen('menuScreen');
            },

            startStoryMode() {
                this.gameMode = 'story';
                this.storyBattleIndex = 0;
                this.populateStoryBeySelection();
                this.showScreen('storySelectScreen');
            },

            populateStoryBeySelection() {
                const container = document.getElementById('storyBeySelection');
                container.innerHTML = '';
                Object.keys(beyblades).forEach(beyKey => {
                    const bey = beyblades[beyKey];
                    const card = document.createElement('div');
                    card.className = 'bey-card';
                    card.innerHTML = `
                        <div class="bey-icon">${bey.icon}</div>
                        <div class="bey-name-text">${bey.name}</div>
                        <div class="bey-stats-small">${bey.type} Type</div>
                        <div class="stat-grid">
                            <div class="stat-mini">A:${bey.attacks[1].damage}</div>
                            <div class="stat-mini">D:${bey.defense}</div>
                            <div class="stat-mini">S:${bey.speed}</div>
                            <div class="stat-mini">H:${bey.hp}</div>
                        </div>
                    `;
                    card.onclick = () => this.selectStoryBey(beyKey, card);
                    container.appendChild(card);
                });
            },

            selectStoryBey(beyKey, element) {
                document.querySelectorAll('#storyBeySelection .bey-card').forEach(c => c.classList.remove('selected'));
                element.classList.add('selected');
                this.storyPlayerBey = beyKey;
                document.getElementById('startStoryBtn').disabled = false;
            },

            beginStory() {
                if (!this.storyPlayerBey) return;
                this.storyPlayerName = 'You';
                this.player1Bey = this.storyPlayerBey;
                
                const opponent = storyOpponents[this.storyBattleIndex];
                this.player2Bey = opponent.bey;
                this.player2Name = opponent.name;

                this.initializeBattle();
            },

            startPvpMode() {
                this.gameMode = 'pvp';
                this.showScreen('pvpSetupScreen');
            },

            proceedToPvpSelection() {
                const p1 = document.getElementById('pvpPlayer1Name').value.trim();
                const p2 = document.getElementById('pvpPlayer2Name').value.trim();
                if (!p1 || !p2) {
                    alert('‚ùå Both players must enter names!');
                    return;
                }
                this.player1Name = p1;
                this.player2Name = p2;
                this.populatePvpBeySelection();
                this.showScreen('pvpBeyScreen');
            },

            populatePvpBeySelection() {
                const p1Container = document.getElementById('pvpPlayer1Beys');
                const p2Container = document.getElementById('pvpPlayer2Beys');
                p1Container.innerHTML = '';
                p2Container.innerHTML = '';

                Object.keys(beyblades).forEach(beyKey => {
                    const bey = beyblades[beyKey];
                    
                    // Player 1 selection
                    const card1 = document.createElement('div');
                    card1.className = 'bey-card';
                    card1.innerHTML = `
                        <div class="bey-icon">${bey.icon}</div>
                        <div class="bey-name-text">${bey.name}</div>
                        <div class="bey-stats-small">${bey.type}</div>
                    `;
                    card1.onclick = () => this.selectPvpBey(1, beyKey, card1);
                    p1Container.appendChild(card1);

                    // Player 2 selection
                    const card2 = document.createElement('div');
                    card2.className = 'bey-card';
                    card2.innerHTML = `
                        <div class="bey-icon">${bey.icon}</div>
                        <div class="bey-name-text">${bey.name}</div>
                        <div class="bey-stats-small">${bey.type}</div>
                    `;
                    card2.onclick = () => this.selectPvpBey(2, beyKey, card2);
                    p2Container.appendChild(card2);
                });
            },

            selectPvpBey(playerNum, beyKey, element) {
                const containerId = playerNum === 1 ? 'pvpPlayer1Beys' : 'pvpPlayer2Beys';
                document.querySelectorAll(`#${containerId} .bey-card`).forEach(c => c.classList.remove('selected'));
                element.classList.add('selected');
                
                if (playerNum === 1) {
                    this.player1Bey = beyKey;
                } else {
                    this.player2Bey = beyKey;
                }

                if (this.player1Bey && this.player2Bey) {
                    document.getElementById('startPvpBtn').disabled = false;
                }
            },

            startPvpBattle() {
                if (!this.player1Bey || !this.player2Bey) return;
                this.initializeBattle();
            },

            initializeBattle() {
                const p1BeyData = beyblades[this.player1Bey];
                const p2BeyData = beyblades[this.player2Bey];

                this.player1MaxHP = p1BeyData.hp;
                this.player2MaxHP = p2BeyData.hp;
                this.player1HP = this.player1MaxHP;
                this.player2HP = this.player2MaxHP;

                this.player1MaxStamina = p1BeyData.stamina;
                this.player2MaxStamina = p2BeyData.stamina;
                this.player1Stamina = this.player1MaxStamina;
                this.player2Stamina = this.player2MaxStamina;

                this.player1Special = 0;
                this.player2Special = 0;

                this.player1DefenseActive = false;
                this.player2DefenseActive = false;

                this.player1Bursts = 0;
                this.player2Bursts = 0;

                this.player1SpecialCD = 0;
                this.player2SpecialCD = 0;

                this.player1BurstCD = 0;
                this.player2BurstCD = 0;

                this.gameActive = false;

                document.getElementById('player1Name').textContent = this.gameMode === 'story' ? this.storyPlayerName : this.player1Name;
                document.getElementById('player2Name').textContent = this.player2Name;
                document.getElementById('p1StatusName').textContent = this.gameMode === 'story' ? this.storyPlayerName : this.player1Name;
                document.getElementById('p2StatusName').textContent = this.player2Name;

                document.getElementById('player1BeyDisplay').textContent = p1BeyData.icon;
                document.getElementById('player2BeyDisplay').textContent = p2BeyData.icon;

                if (this.gameMode === 'story') {
                    const opponent = storyOpponents[this.storyBattleIndex];
                    document.getElementById('storyBattleInfo').style.display = 'block';
                    document.getElementById('battleNumberDisplay').textContent = `BATTLE ${this.storyBattleIndex + 1}`;
                    document.getElementById('opponentInfoDisplay').innerHTML = `
                        <p>Opponent: <strong>${opponent.name}</strong></p>
                        <p>Beyblande: ${p2BeyData.name} ${p2BeyData.icon}</p>
                    `;
                    document.getElementById('countdownBox').style.display = 'block';
                } else {
                    document.getElementById('storyBattleInfo').style.display = 'none';
                    document.getElementById('countdownBox').style.display = 'block';
                }

                this.clearBattleLog();
                this.addBattleLog(`‚öîÔ∏è BATTLE START!`);
                this.addBattleLog(`${p1BeyData.name} ${p1BeyData.icon} vs ${p2BeyData.name} ${p2BeyData.icon}`);

                this.updateUI();
                this.showScreen('battleScreen');
                this.startCountdown();
            },

            startCountdown() {
                const countdownEl = document.getElementById('countdown');
                let count = 3;
                const interval = setInterval(() => {
                    count--;
                    countdownEl.textContent = count;
                    if (count === 0) {
                        clearInterval(interval);
                        document.getElementById('countdownBox').style.display = 'none';
                        this.addBattleLog('üöÄ LET IT RIP! üöÄ');
                        this.gameActive = true;
                        this.startGameLoop();
                    }
                }, 1000);
            },

            startGameLoop() {
                // Auto stamina regen and cooldowns
                setInterval(() => {
                    if (!this.gameActive) return;

                    // Stamina regen
                    this.player1Stamina = Math.min(this.player1MaxStamina, this.player1Stamina + 8);
                    this.player2Stamina = Math.min(this.player2MaxStamina, this.player2Stamina + 8);

                    // Special charge
                    this.player1Special = Math.min(100, this.player1Special + 3);
                    this.player2Special = Math.min(100, this.player2Special + 3);

                    // Cooldowns
                    if (this.player1SpecialCD > 0) this.player1SpecialCD--;
                    if (this.player2SpecialCD > 0) this.player2SpecialCD--;
                    if (this.player1BurstCD > 0) this.player1BurstCD--;
                    if (this.player2BurstCD > 0) this.player2BurstCD--;

                    // Defense wear off
                    if (this.player1DefenseActive && Math.random() > 0.7) this.player1DefenseActive = false;
                    if (this.player2DefenseActive && Math.random() > 0.7) this.player2DefenseActive = false;

                    // Auto enemy actions in story mode
                    if (this.gameMode === 'story' && Math.random() > 0.5) {
                        this.aiAction(2);
                    }

                    this.updateUI();
                }, 1000);
            },

            playerAction(playerNum, action) {
                if (!this.gameActive) return;

                const isPlayer1 = playerNum === 1;
                const enemyNum = isPlayer1 ? 2 : 1;
                const beyKey = isPlayer1 ? this.player1Bey : this.player2Bey;
                const beyData = beyblades[beyKey];
                const playerName = isPlayer1 ? (this.gameMode === 'story' ? this.storyPlayerName : this.player1Name) : this.player2Name;

                switch(action) {
                    case 'attack':
                        this.performAttack(playerNum, beyData, playerName);
                        break;
                    case 'defend':
                        this.performDefend(playerNum, playerName);
                        break;
                    case 'special':
                        if (isPlayer1 && this.player1SpecialCD > 0) return;
                        if (!isPlayer1 && this.player2SpecialCD > 0) return;
                        if (isPlayer1 && this.player1Special < 80) return;
                        if (!isPlayer1 && this.player2Special < 80) return;
                        this.performSpecial(playerNum, beyData, playerName);
                        break;
                    case 'burst':
                        if (isPlayer1 && this.player1BurstCD > 0) return;
                        if (!isPlayer1 && this.player2BurstCD > 0) return;
                        this.performBurst(playerNum, beyData, playerName);
                        break;
                }

                if (this.gameMode === 'pvp') {
                    setTimeout(() => this.aiAction(enemyNum), 1500);
                }

                this.updateUI();
            },

            performAttack(playerNum, beyData, playerName) {
                const isPlayer1 = playerNum === 1;
                const enemyNum = isPlayer1 ? 2 : 1;

                if (isPlayer1 && this.player1Stamina < 30) {
                    this.addBattleLog(`‚ùå ${playerName}'s stamina is too low!`);
                    return;
                }
                if (!isPlayer1 && this.player2Stamina < 30) {
                    this.addBattleLog(`‚ùå ${playerName}'s stamina is too low!`);
                    return;
                }

                const attack = beyData.attacks[Math.floor(Math.random() * beyData.attacks.length)];
                let damage = attack.damage * (0.8 + Math.random() * 0.4);

                // Apply defense reduction
                if (enemyNum === 1 && this.player1DefenseActive) {
                    damage *= 0.5;
                    this.addBattleLog(`üõ°Ô∏è Defense reduced the damage!`);
                }
                if (enemyNum === 2 && this.player2DefenseActive) {
                    damage *= 0.5;
                    this.addBattleLog(`üõ°Ô∏è Defense reduced the damage!`);
                }

                if (isPlayer1) {
                    this.player1Stamina -= attack.staminaCost;
                    this.player2HP -= damage;
                    this.player1Special += 15;
                } else {
                    this.player2Stamina -= attack.staminaCost;
                    this.player1HP -= damage;
                    this.player2Special += 15;
                }

                this.addBattleLog(`<span class="move-name">${playerName}</span> used ${attack.name}! ${Math.ceil(damage)} damage!`);
                this.animateHit(enemyNum);
            },

            performDefend(playerNum, playerName) {
                const isPlayer1 = playerNum === 1;
                if (isPlayer1) {
                    this.player1Stamina -= 10;
                    this.player1DefenseActive = true;
                    this.player1Special += 10;
                } else {
                    this.player2Stamina -= 10;
                    this.player2DefenseActive = true;
                    this.player2Special += 10;
                }
                this.addBattleLog(`üõ°Ô∏è ${playerName} takes a defensive stance!`);
            },

            performSpecial(playerNum, beyData, playerName) {
                const isPlayer1 = playerNum === 1;
                const enemyNum = isPlayer1 ? 2 : 1;
                const special = beyData.specialAttack;

                let damage = special.damage * (0.9 + Math.random() * 0.2);

                if (enemyNum === 1 && this.player1DefenseActive) {
                    damage *= 0.6;
                }
                if (enemyNum === 2 && this.player2DefenseActive) {
                    damage *= 0.6;
                }

                if (isPlayer1) {
                    this.player1Stamina -= special.staminaCost;
                    this.player1SpecialCD = 3;
                    this.player1Special = 0;
                    this.player2HP -= damage;
                } else {
                    this.player2Stamina -= special.staminaCost;
                    this.player2SpecialCD = 3;
                    this.player2Special = 0;
                    this.player1HP -= damage;
                }

                this.addBattleLog(`<span class="move-name">‚ö° ${playerName} SPECIAL ATTACK! ‚ö°</span> ${special.name}! ${Math.ceil(damage)} DAMAGE!`);
                this.animateHit(enemyNum);
            },

            performBurst(playerNum, beyData, playerName) {
                const isPlayer1 = playerNum === 1;
                const enemyNum = isPlayer1 ? 2 : 1;
                const burst = beyData.burst;
                const enemyBursts = enemyNum === 1 ? this.player1Bursts : this.player2Bursts;

                if (enemyBursts >= 3) {
                    // Burst prevented
                    this.addBattleLog(`‚ùå ${playerName}'s burst was blocked!`);
                    if (isPlayer1) {
                        this.player1Bursts++;
                    } else {
                        this.player2Bursts++;
                    }
                    return;
                }

                let damage = burst.damage * (0.95 + Math.random() * 0.1);

                if (isPlayer1) {
                    this.player1BurstCD = 4;
                    this.player1Bursts++;
                    this.player2HP -= damage;
                    this.player2Bursts = 0;
                } else {
                    this.player2BurstCD = 4;
                    this.player2Bursts++;
                    this.player1HP -= damage;
                    this.player1Bursts = 0;
                }

                this.addBattleLog(`<span class="move-name">üí• ${playerName} BURST FINISH! üí•</span> ${burst.name}! ${Math.ceil(damage)} DAMAGE!`);
                this.animateHit(enemyNum);
            },

            aiAction(playerNum) {
                if (!this.gameActive) return;
                const beyData = beyblades[this.player2Bey];
                const stamina = this.player2Stamina;
                const special = this.player2Special;

                let action = 'attack';
                if (special >= 80 && Math.random() > 0.6) {
                    action = 'special';
                } else if (this.player1HP > this.player2HP && Math.random() > 0.7) {
                    action = 'defend';
                } else if (stamina < 30) {
                    action = 'defend';
                }

                this.playerAction(playerNum, action);
            },

            animateHit(playerNum) {
                const displayId = playerNum === 1 ? 'player1BeyDisplay' : 'player2BeyDisplay';
                const display = document.getElementById(displayId);
                display.classList.remove('hit');
                void display.offsetWidth;
                display.classList.add('hit');
            },

            updateUI() {
                const p1BeyData = beyblades[this.player1Bey];
                const p2BeyData = beyblades[this.player2Bey];

                // HP bars
                const p1HpPercent = (this.player1HP / this.player1MaxHP) * 100;
                const p2HpPercent = (this.player2HP / this.player2MaxHP) * 100;

                document.getElementById('player1Hp').style.width = p1HpPercent + '%';
                document.getElementById('player2Hp').style.width = p2HpPercent + '%';

                if (p1HpPercent <= 25) {
                    document.getElementById('player1Hp').classList.add('critical');
                }
                if (p2HpPercent <= 25) {
                    document.getElementById('player2Hp').classList.add('critical');
                }

                // Stamina bars
                const p1StaPercent = (this.player1Stamina / this.player1MaxStamina) * 100;
                const p2StaPercent = (this.player2Stamina / this.player2MaxStamina) * 100;

                document.getElementById('player1Stamina').style.width = p1StaPercent + '%';
                document.getElementById('player2Stamina').style.width = p2StaPercent + '%';

                // Special bars
                document.getElementById('player1Special').style.width = this.player1Special + '%';
                document.getElementById('player2Special').style.width = this.player2Special + '%';

                // Status display
                document.getElementById('p1HpStatus').textContent = `${Math.ceil(this.player1HP)}/${this.player1MaxHP}`;
                document.getElementById('p2HpStatus').textContent = `${Math.ceil(this.player2HP)}/${this.player2MaxHP}`;

                document.getElementById('p1StaminaStatus').textContent = `${Math.ceil(this.player1Stamina)}/${this.player1MaxStamina}`;
                document.getElementById('p2StaminaStatus').textContent = `${Math.ceil(this.player2Stamina)}/${this.player2MaxStamina}`;

                document.getElementById('p1SpecialStatus').textContent = `${Math.ceil(this.player1Special)}%`;
                document.getElementById('p2SpecialStatus').textContent = `${Math.ceil(this.player2Special)}%`;

                document.getElementById('p1Bursts').textContent = this.player1Bursts;
                document.getElementById('p2Bursts').textContent = this.player2Bursts;

                // Button states
                document.getElementById('p1Attack').disabled = this.player1Stamina < 30 || !this.gameActive;
                document.getElementById('p2Attack').disabled = this.player2Stamina < 30 || !this.gameActive;

                document.getElementById('p1Defend').disabled = !this.gameActive;
                document.getElementById('p2Defend').disabled = !this.gameActive;

                document.getElementById('p1Special').disabled = this.player1Special 